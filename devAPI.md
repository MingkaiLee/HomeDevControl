# Device API Reference

Created by Li Mingkai on 2021.05.27

**[说明]** 本文档将记录newdevice.py文件中实现的类及其接口的功能, 方便后续开发查阅及更改, 本部分只记录方法功能, 具体输入输出规范已在注释中。

## 1. 设备基类

### 1.1. Device

该类为本文件中所有设备的基类, 具有一些包括地址计算在内的通用方法, 为接口定义而没有具体实现的方法不在本表中。

|方法名称|方法功能|
|-|-|
|getWordStr|将10进制整数转为xx xx式的表示十六进制双字节的字符串, 不会作越界检查|
|getRegStr|将10进制整数转为xxxxxxxx式的表示二进制单字节的字符串, 不会作越界检查|
|getDevAddr|返回设备的目的地址|
|_generateFrane|生成数据帧的低层级接口, 填入数据域内容后生成完整的数据帧|
---

## 2. 普通设备类

这里的普通设备为除面板之外的设备, 它们将有面板通过控制器来控制。目前已实现的有传感器, 灯具和窗帘。

### 2.1. Sensor

六合一传感器, 可得温度, 湿度, PM2.5, CO2, 甲醛, VOC等参数。

|方法名称|方法功能|
|-|-|
|generateCallFrame|生成获取所有传感器参数的命令帧|
|updateData|更新实例中存储的传感器数据|
|getData|获取传感器的数据|
|generateValFrame|生成获取单一传感器参数的命令帧, 不常用|

### 2.2. Lamp

灯具, 具有调节亮度和色温的功能, 可控制延迟执行时间和变化时间。

|方法名称|方法功能|
|-|-|
|generateCallFrame|生成获取灯具状态的命令帧|
|generateWriteFrame|生成改变灯具状态的命令帧|

### 2.3. Curtain

窗帘, 暂未实现。

|方法名称|方法功能|
|-|-|
|||
---

## 2. 面板类

面板设备的类, 未来可能有更多种控制面板加入, 在本架构中, 系统中存在的设备的实例对象都保存在面板对象中。

### 2.1. Panel

面板基类, 包含所有类型面板都会用到的功能。

|方法名称|方法功能|
|-|-|
|getDevice|获取某类可控设备的实例对象或对象列表|
|addDevice|向面板对象中添加可控设备|

### 2.2. Panel1

第1类面板, 根据控制面板4.0V1.5的Modbus协议开发的面板。

|方法名称|方法功能|
|-|-|
|generateFrame|生成数据帧的低层级接口, 填入数据域内容后生成完整的数据帧|
|parseRegister|解析面板某个寄存器中的内容|
|generateFrameFromData|按照协议解析从面板发到本地的命令, 并针对可控设备生成相应的控制帧|
|generateSensorQuery|驱动可控传感器生成获取传感器最新数据的帧|
|pushSensorFrame|生成在面板中更新传感器数据的帧|
